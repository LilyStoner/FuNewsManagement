@page
@model Assignment1_PRN232_FE.Pages.Staff.Articles.CreateModel
@{
    ViewData["Title"] = "Create Article";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/Staff/Dashboard">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="/Staff/Articles">My Articles</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Create Article</li>
                </ol>
            </nav>

            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-0">Create New Article</h1>
                    <p class="text-muted">Write and publish a new news article</p>
                </div>
                <div>
                    <a href="/Staff/Articles" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Articles
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">
            <div class="card shadow">
                <div class="card-header">
                    <h6 class="m-0 font-weight-bold text-primary">Article Information</h6>
                </div>
                <div class="card-body">
                    <form method="post" id="createArticleForm">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label asp-for="Article.NewsTitle" class="form-label">Article Title *</label>
                                    <input asp-for="Article.NewsTitle" class="form-control" placeholder="Enter article title" />
                                    <span asp-validation-for="Article.NewsTitle" class="text-danger"></span>
                                </div>

                                <div class="mb-3">
                                    <label asp-for="Article.Headline" class="form-label">Headline *</label>
                                    <input asp-for="Article.Headline" class="form-control" placeholder="Brief headline for the article" />
                                    <span asp-validation-for="Article.Headline" class="text-danger"></span>
                                    <div class="form-text">A short, catchy headline that summarizes the article.</div>
                                </div>

                                <div class="mb-3">
                                    <label asp-for="Article.NewsContent" class="form-label">Content</label>
                                    <textarea asp-for="Article.NewsContent" class="form-control" rows="12" 
                                              placeholder="Write your article content here..."></textarea>
                                    <span asp-validation-for="Article.NewsContent" class="text-danger"></span>
                                    <div class="form-text">
                                        <span id="contentCounter">0</span>/4000 characters
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label asp-for="Article.NewsSource" class="form-label">News Source</label>
                                    <input asp-for="Article.NewsSource" class="form-control" placeholder="Source of the news (optional)" />
                                    <span asp-validation-for="Article.NewsSource" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="Article.CategoryId" class="form-label">Category *</label>
                                    <select asp-for="Article.CategoryId" class="form-select">
                                        <option value="">Select Category</option>
                                        @foreach (var category in Model.Categories)
                                        {
                                            <option value="@category.CategoryId">@category.CategoryName</option>
                                        }
                                    </select>
                                    <span asp-validation-for="Article.CategoryId" class="text-danger"></span>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Tags</label>
                                    <div class="border rounded p-3" style="max-height: 200px; overflow-y: auto;">
                                        @foreach (var tag in Model.Tags)
                                        {
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" 
                                                       name="Article.SelectedTagIds" value="@tag.TagId" 
                                                       id="tag_@tag.TagId">
                                                <label class="form-check-label" for="tag_@tag.TagId">
                                                    @tag.TagName
                                                </label>
                                            </div>
                                        }
                                    </div>
                                    <div class="form-text">Select relevant tags for your article.</div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Publication Status</label>
                                    <div class="form-check">
                                        <input asp-for="Article.NewsStatus" type="checkbox" class="form-check-input" id="newsStatus">
                                        <label asp-for="Article.NewsStatus" class="form-check-label" for="newsStatus">
                                            Publish immediately
                                        </label>
                                    </div>
                                    <div class="form-text">Uncheck to save as draft.</div>
                                </div>

                                <div class="preview-section">
                                    <h6 class="text-muted mb-2">Article Preview</h6>
                                    <div class="card">
                                        <div class="card-body p-3">
                                            <h6 class="card-title" id="previewTitle">Article Title</h6>
                                            <p class="card-text text-muted small" id="previewHeadline">Article headline</p>
                                            <div class="d-flex justify-content-between">
                                                <small class="text-muted" id="previewCategory">Category</small>
                                                <small class="text-muted" id="previewStatus">Draft</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr>

                        <div class="d-flex justify-content-between">
                            <div>
                                <button type="button" class="btn btn-outline-secondary" onclick="window.history.back()">
                                    <i class="fas fa-times me-2"></i>Cancel
                                </button>
                            </div>
                            <div>
                                <button type="submit" class="btn btn-success me-2" name="action" value="save">
                                    <i class="fas fa-save me-2"></i>Save as Draft
                                </button>
                                <button type="submit" class="btn btn-primary" name="action" value="publish">
                                    <i class="fas fa-upload me-2"></i>Save & Publish
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <script>
        $(document).ready(function() {
            // Initialize TinyMCE for rich text editing
            tinymce.init({
                selector: '#Article_NewsContent',
                height: 300,
                plugins: 'advlist autolink lists link image charmap print preview hr anchor pagebreak',
                toolbar_mode: 'floating',
                toolbar: 'undo redo | formatselect | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help',
                content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }',
                setup: function (editor) {
                    editor.on('input', function () {
                        updatePreview();
                        updateCharCount();
                    });
                }
            });

            // Update character count
            function updateCharCount() {
                const content = tinymce.get('Article_NewsContent').getContent({format: 'text'});
                $('#contentCounter').text(content.length);
                
                if (content.length > 4000) {
                    $('#contentCounter').addClass('text-danger');
                } else {
                    $('#contentCounter').removeClass('text-danger');
                }
            }

            // Real-time preview updates
            function updatePreview() {
                const title = $('#Article_NewsTitle').val() || 'Article Title';
                const headline = $('#Article_Headline').val() || 'Article headline';
                const categoryText = $('#Article_CategoryId option:selected').text() || 'Category';
                const isPublished = $('#Article_NewsStatus').is(':checked');
                
                $('#previewTitle').text(title);
                $('#previewHeadline').text(headline);
                $('#previewCategory').text(categoryText);
                $('#previewStatus').text(isPublished ? 'Published' : 'Draft')
                    .removeClass('text-success text-muted')
                    .addClass(isPublished ? 'text-success' : 'text-muted');
            }

            // Bind preview updates to form changes
            $('#Article_NewsTitle, #Article_Headline').on('input', updatePreview);
            $('#Article_CategoryId, #Article_NewsStatus').on('change', updatePreview);

            // Handle save vs publish
            $('button[name="action"][value="save"]').click(function() {
                $('#Article_NewsStatus').prop('checked', false);
            });
            
            $('button[name="action"][value="publish"]').click(function() {
                $('#Article_NewsStatus').prop('checked', true);
            });

            // Initial preview update
            updatePreview();
        });
    </script>
}

<style>
.preview-section {
    position: sticky;
    top: 20px;
}

.card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
}

.btn-success {
    background: linear-gradient(135deg, #56CCF2 0%, #2F80ED 100%);
    border: none;
}

.breadcrumb {
    background: transparent;
    padding: 0;
}

.breadcrumb a {
    color: #667eea;
    text-decoration: none;
}

.breadcrumb a:hover {
    text-decoration: underline;
}

#contentCounter.text-danger {
    font-weight: bold;
}

.form-check-input:checked {
    background-color: #667eea;
    border-color: #667eea;
}
</style>